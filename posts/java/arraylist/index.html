<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=content-type content="text/html"><meta name=viewport content="width=device-width,initial-scale=1"><title itemprop=name>Java ArrayList 源码 | Leon's Blog</title>
<meta property="og:title" content="Java ArrayList 源码 | Leon's Blog"><meta name=twitter:title content="Java ArrayList 源码 | Leon's Blog"><meta itemprop=name content="Java ArrayList 源码 | Leon's Blog"><meta name=application-name content="Java ArrayList 源码 | Leon's Blog"><meta property="og:site_name" content="Leon's Blog"><meta name=description content="支持亮色和暗色模式的极简 Hugo 博客主题"><meta itemprop=description content="支持亮色和暗色模式的极简 Hugo 博客主题"><meta property="og:description" content="支持亮色和暗色模式的极简 Hugo 博客主题"><meta name=twitter:description content="支持亮色和暗色模式的极简 Hugo 博客主题"><meta property="og:locale" content="zh-cn"><meta name=language content="zh-cn"><link rel=alternate hreflang=zh-cn href=https://ileonli.github.io/posts/java/arraylist/ title=Chinese><meta property="og:type" content="article"><meta property="og:article:published_time" content=2022-02-03T15:24:06+0800><meta property="article:published_time" content=2022-02-03T15:24:06+0800><meta property="og:url" content="https://ileonli.github.io/posts/java/arraylist/"><meta property="og:article:author" content="Leon Li"><meta property="article:author" content="Leon Li"><meta name=author content="Leon Li"><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"Article","headline":"Java ArrayList 源码","author":{"@type":"Person","name":""},"datePublished":"2022-02-03","description":"","wordCount":986,"mainEntityOfPage":"True","dateModified":"2022-02-03","image":{"@type":"imageObject","url":""},"publisher":{"@type":"Organization","name":"Leon\u0027s Blog"}}</script><meta name=generator content="Hugo 0.146.4"><meta property="og:url" content="https://ileonli.github.io/posts/java/arraylist/"><meta property="og:site_name" content="Leon's Blog"><meta property="og:title" content="Java ArrayList 源码"><meta property="og:description" content='Java ArrayList 源码 属性 从类中的属性中可以看到，ArrayList 默认容量为 10，底层使用一个 Object[] 数组保存所有元素。
/** * Default initial capacity. */ private static final int DEFAULT_CAPACITY = 10; /** * Shared empty array instance used for empty instances. */ private static final Object[] EMPTY_ELEMENTDATA = {}; /** * Shared empty array instance used for default sized empty instances. We * distinguish this from EMPTY_ELEMENTDATA to know how much to inflate when * first element is added. */ private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {}; /** * The array buffer into which the elements of the ArrayList are stored. * The capacity of the ArrayList is the length of this array buffer. Any * empty ArrayList with elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA * will be expanded to DEFAULT_CAPACITY when the first element is added. */ transient Object[] elementData; // non-private to simplify nested class access /** * The size of the ArrayList (the number of elements it contains). * * @serial */ private int size; 构造器 默认构造器 /** * Constructs an empty list with an initial capacity of ten. */ public ArrayList() { this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA; } 指定长度 /** * Constructs an empty list with the specified initial capacity. * * @param initialCapacity the initial capacity of the list * @throws IllegalArgumentException if the specified initial capacity * is negative */ public ArrayList(int initialCapacity) { if (initialCapacity > 0) { // 新建长度为 initialCapacity 的数组 this.elementData = new Object[initialCapacity]; } else if (initialCapacity == 0) { this.elementData = EMPTY_ELEMENTDATA; } else { throw new IllegalArgumentException("Illegal Capacity: "+ initialCapacity); } } 传入集合 /** * Constructs a list containing the elements of the specified * collection, in the order they are returned by the collection&#39;s * iterator. * * @param c the collection whose elements are to be placed into this list * @throws NullPointerException if the specified collection is null */ public ArrayList(Collection<? extends E> c) { elementData = c.toArray(); // 如果传入的集合长度不为 0 ，则把集合中的元素 copy 到 elementData 中 if ((size = elementData.length) != 0) { // defend against c.toArray (incorrectly) not returning Object[] // (see e.g. https://bugs.openjdk.java.net/browse/JDK-6260652) if (elementData.getClass() != Object[].class) elementData = Arrays.copyOf(elementData, size, Object[].class); } else { // replace with empty array. this.elementData = EMPTY_ELEMENTDATA; } } 扩容 最大长度 根据注释可以看到，有些虚拟机需要在数组中保存额外信息（保存的额外信息）需要占用一定的空间，所以 ArrayList 的最大长度为 2^32 - 8'><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-02-03T15:24:06+08:00"><meta property="article:modified_time" content="2022-02-03T15:24:06+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Java ArrayList 源码"><meta name=twitter:description content='Java ArrayList 源码 属性 从类中的属性中可以看到，ArrayList 默认容量为 10，底层使用一个 Object[] 数组保存所有元素。
/** * Default initial capacity. */ private static final int DEFAULT_CAPACITY = 10; /** * Shared empty array instance used for empty instances. */ private static final Object[] EMPTY_ELEMENTDATA = {}; /** * Shared empty array instance used for default sized empty instances. We * distinguish this from EMPTY_ELEMENTDATA to know how much to inflate when * first element is added. */ private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {}; /** * The array buffer into which the elements of the ArrayList are stored. * The capacity of the ArrayList is the length of this array buffer. Any * empty ArrayList with elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA * will be expanded to DEFAULT_CAPACITY when the first element is added. */ transient Object[] elementData; // non-private to simplify nested class access /** * The size of the ArrayList (the number of elements it contains). * * @serial */ private int size; 构造器 默认构造器 /** * Constructs an empty list with an initial capacity of ten. */ public ArrayList() { this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA; } 指定长度 /** * Constructs an empty list with the specified initial capacity. * * @param initialCapacity the initial capacity of the list * @throws IllegalArgumentException if the specified initial capacity * is negative */ public ArrayList(int initialCapacity) { if (initialCapacity > 0) { // 新建长度为 initialCapacity 的数组 this.elementData = new Object[initialCapacity]; } else if (initialCapacity == 0) { this.elementData = EMPTY_ELEMENTDATA; } else { throw new IllegalArgumentException("Illegal Capacity: "+ initialCapacity); } } 传入集合 /** * Constructs a list containing the elements of the specified * collection, in the order they are returned by the collection&#39;s * iterator. * * @param c the collection whose elements are to be placed into this list * @throws NullPointerException if the specified collection is null */ public ArrayList(Collection<? extends E> c) { elementData = c.toArray(); // 如果传入的集合长度不为 0 ，则把集合中的元素 copy 到 elementData 中 if ((size = elementData.length) != 0) { // defend against c.toArray (incorrectly) not returning Object[] // (see e.g. https://bugs.openjdk.java.net/browse/JDK-6260652) if (elementData.getClass() != Object[].class) elementData = Arrays.copyOf(elementData, size, Object[].class); } else { // replace with empty array. this.elementData = EMPTY_ELEMENTDATA; } } 扩容 最大长度 根据注释可以看到，有些虚拟机需要在数组中保存额外信息（保存的额外信息）需要占用一定的空间，所以 ArrayList 的最大长度为 2^32 - 8'><link rel=canonical href=https://ileonli.github.io/posts/java/arraylist/><link href=/style.min.2d921c18cf1ec555ffc03d59a8adc211c402c68c930c27d6a0c306ab175a8d09.css rel=stylesheet><link href=/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css rel=stylesheet><link rel=apple-touch-icon sizes=180x180 href=/icons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/icons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/icons/favicon-16x16.png><link rel=mask-icon href=/icons/safari-pinned-tab.svg><link rel="shortcut icon" href=/favicon.ico><link rel=manifest href=https://ileonli.github.io/site.webmanifest><meta name=msapplication-config content="/browserconfig.xml"><meta name=msapplication-TileColor content="#2d89ef"><meta name=theme-color content="#434648"><link rel=icon type=image/svg+xml href=/icons/favicon.svg></head><body data-theme=auto class=notransition><script src=/js/theme.min.8961c317c5b88b953fe27525839672c9343f1058ab044696ca225656c8ba2ab0.js integrity="sha256-iWHDF8W4i5U/4nUlg5ZyyTQ/EFirBEaWyiJWVsi6KrA="></script><div class=navbar role=navigation><nav class=menu aria-label="Main Navigation"><a href=https://ileonli.github.io/ class=logo><svg width="25" height="25" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><title>首页</title><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
</a><input type=checkbox id=menu-trigger class=menu-trigger>
<label for=menu-trigger><span class=menu-icon><svg width="25" height="25" stroke="currentcolor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7H3.40726"/><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488H3.49301"/><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"/><path stroke-linecap="round" stroke-linejoin="round" d="M.5 12.5V1.5c0-.552285.447715-1 1-1h11C13.0523.5 13.5.947715 13.5 1.5v11C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C.947715 13.5.5 13.0523.5 12.5z"/></svg></span></label><div class=trigger><ul class=trigger-container><li><a class=menu-link href=/>首页</a></li><li><a class="menu-link active" href=/posts/>文章</a></li><li><a class=menu-link href=/about/>关于</a></li><li class=menu-separator><span>|</span></li></ul><a id=mode href=#><svg class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1"><title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1=".5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1=".5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/></g></svg><svg class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1"><title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1=".5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1=".5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/></g></svg></a></div></nav></div><div class="wrapper post"><main class=page-content aria-label=Content><article><header class=header><h1 class=header-title>Java ArrayList 源码</h1><div class=post-meta><time datetime=2022-02-03T15:24:06+08:00 itemprop=datePublished>2022年02月03日</time></div></header><details class=toc zgotmplz><summary><b>目录</b></summary><nav id=TableOfContents><ul><li><a href=#属性>属性</a></li><li><a href=#构造器>构造器</a><ul><li><a href=#默认构造器>默认构造器</a></li><li><a href=#指定长度>指定长度</a></li><li><a href=#传入集合>传入集合</a></li></ul></li><li><a href=#扩容>扩容</a><ul><li><a href=#最大长度>最大长度</a></li></ul></li><li><a href=#add>add()</a><ul><li><a href=#尾部插入-adde-e>尾部插入 add(E e)</a></li><li><a href=#任意位置插入-addint-index-e-element>任意位置插入 add(int index, E element)</a></li></ul></li><li><a href=#remove>remove()</a></li></ul></nav></details><div class=page-content><h1 id=java-arraylist-源码>Java ArrayList 源码</h1><h2 id=属性>属性</h2><p>从类中的属性中可以看到，<code>ArrayList</code> 默认容量为 10，底层使用一个 <code>Object[]</code> 数组保存所有元素。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Default initial capacity.
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>DEFAULT_CAPACITY</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>10</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Shared empty array instance used for empty instances.
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=n>EMPTY_ELEMENTDATA</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Shared empty array instance used for default sized empty instances. We
</span></span></span><span class=line><span class=cl><span class=cm> * distinguish this from EMPTY_ELEMENTDATA to know how much to inflate when
</span></span></span><span class=line><span class=cl><span class=cm> * first element is added.
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=n>DEFAULTCAPACITY_EMPTY_ELEMENTDATA</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * The array buffer into which the elements of the ArrayList are stored.
</span></span></span><span class=line><span class=cl><span class=cm> * The capacity of the ArrayList is the length of this array buffer. Any
</span></span></span><span class=line><span class=cl><span class=cm> * empty ArrayList with elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA
</span></span></span><span class=line><span class=cl><span class=cm> * will be expanded to DEFAULT_CAPACITY when the first element is added.
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>transient</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=n>elementData</span><span class=p>;</span><span class=w> </span><span class=c1>// non-private to simplify nested class access</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * The size of the ArrayList (the number of elements it contains).
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @serial
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>size</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h2 id=构造器>构造器</h2><h3 id=默认构造器>默认构造器</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Constructs an empty list with an initial capacity of ten.
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=nf>ArrayList</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>this</span><span class=p>.</span><span class=na>elementData</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DEFAULTCAPACITY_EMPTY_ELEMENTDATA</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h3 id=指定长度>指定长度</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Constructs an empty list with the specified initial capacity.
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @param  initialCapacity  the initial capacity of the list
</span></span></span><span class=line><span class=cl><span class=cm> * @throws IllegalArgumentException if the specified initial capacity
</span></span></span><span class=line><span class=cl><span class=cm> *         is negative
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=nf>ArrayList</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>initialCapacity</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>initialCapacity</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=c1>// 新建长度为 initialCapacity 的数组</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>elementData</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Object</span><span class=o>[</span><span class=n>initialCapacity</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>initialCapacity</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>elementData</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>EMPTY_ELEMENTDATA</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>IllegalArgumentException</span><span class=p>(</span><span class=s>&#34;Illegal Capacity: &#34;</span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                           </span><span class=n>initialCapacity</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h3 id=传入集合>传入集合</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Constructs a list containing the elements of the specified
</span></span></span><span class=line><span class=cl><span class=cm> * collection, in the order they are returned by the collection&#39;s
</span></span></span><span class=line><span class=cl><span class=cm> * iterator.
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @param c the collection whose elements are to be placed into this list
</span></span></span><span class=line><span class=cl><span class=cm> * @throws NullPointerException if the specified collection is null
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=nf>ArrayList</span><span class=p>(</span><span class=n>Collection</span><span class=o>&lt;?</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>E</span><span class=o>&gt;</span><span class=w> </span><span class=n>c</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>elementData</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>c</span><span class=p>.</span><span class=na>toArray</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// 如果传入的集合长度不为 0 ，则把集合中的元素 copy 到 elementData 中</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>((</span><span class=n>size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>elementData</span><span class=p>.</span><span class=na>length</span><span class=p>)</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// defend against c.toArray (incorrectly) not returning Object[]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// (see e.g. https://bugs.openjdk.java.net/browse/JDK-6260652)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>elementData</span><span class=p>.</span><span class=na>getClass</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>elementData</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Arrays</span><span class=p>.</span><span class=na>copyOf</span><span class=p>(</span><span class=n>elementData</span><span class=p>,</span><span class=w> </span><span class=n>size</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// replace with empty array.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>elementData</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>EMPTY_ELEMENTDATA</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h2 id=扩容>扩容</h2><h3 id=最大长度>最大长度</h3><p>根据注释可以看到，有些虚拟机需要在数组中保存额外信息（<a href=https://stackoverflow.com/questions/35756277/why-the-maximum-array-size-of-arraylist-is-integer-max-value-8>保存的额外信息</a>）需要占用一定的空间，所以 <code>ArrayList</code> 的最大长度为 <code>2^32 - 8</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * The maximum size of array to allocate (unless necessary).
</span></span></span><span class=line><span class=cl><span class=cm> * Some VMs reserve some header words in an array.
</span></span></span><span class=line><span class=cl><span class=cm> * Attempts to allocate larger arrays may result in
</span></span></span><span class=line><span class=cl><span class=cm> * OutOfMemoryError: Requested array size exceeds VM limit
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>MAX_ARRAY_SIZE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Integer</span><span class=p>.</span><span class=na>MAX_VALUE</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>8</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>每次扩容时候，<code>newCapacity</code> 为 <code>oldCapacity + (oldCapacity >> 1)</code>，相当于旧容量的 1.5 倍</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Returns a capacity at least as large as the given minimum capacity.
</span></span></span><span class=line><span class=cl><span class=cm> * Returns the current capacity increased by 50% if that suffices.
</span></span></span><span class=line><span class=cl><span class=cm> * Will not return a capacity greater than MAX_ARRAY_SIZE unless
</span></span></span><span class=line><span class=cl><span class=cm> * the given minimum capacity is greater than MAX_ARRAY_SIZE.
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @param minCapacity the desired minimum capacity
</span></span></span><span class=line><span class=cl><span class=cm> * @throws OutOfMemoryError if minCapacity is less than zero
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=nf>newCapacity</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>minCapacity</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// overflow-conscious code</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>oldCapacity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>elementData</span><span class=p>.</span><span class=na>length</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>newCapacity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>oldCapacity</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=p>(</span><span class=n>oldCapacity</span><span class=w> </span><span class=o>&gt;&gt;</span><span class=w> </span><span class=n>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// 按照扩容规则计算的新容量小于预期容量</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>newCapacity</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>minCapacity</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=c1>// 当使用默认构造器进行初始化时，在此处才进行底层数组的初始化</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=c1>// 新的底层数组长度为默认容量（10）和期望容量之间最大的值</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>elementData</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>DEFAULTCAPACITY_EMPTY_ELEMENTDATA</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>Math</span><span class=p>.</span><span class=na>max</span><span class=p>(</span><span class=n>DEFAULT_CAPACITY</span><span class=p>,</span><span class=w> </span><span class=n>minCapacity</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>minCapacity</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=c1>// overflow</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>OutOfMemoryError</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>minCapacity</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// 按照扩容规则计算出的容量是否超过默认最大容量？</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// 不超过：则直接返回</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// 超过：根据 hugeCapacity() 计算出新的长度</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span><span class=n>newCapacity</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>MAX_ARRAY_SIZE</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>?</span><span class=w> </span><span class=n>newCapacity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>:</span><span class=w> </span><span class=n>hugeCapacity</span><span class=p>(</span><span class=n>minCapacity</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>当通过默认规则扩大为原来 1.5 后如果超过默认最大容量时，则通过比较<strong>预期容量</strong>和<strong>默认最大容量</strong>来判断最大容量；
当预期容量比默认的 <code>MAX_ARRAY_SIZE</code> 大时，则返回 <code>Integer.MAX_VALUE</code> 否则返回默认的 <code>MAX_ARRAY_SIZE</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=nf>hugeCapacity</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>minCapacity</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>minCapacity</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=c1>// overflow</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>OutOfMemoryError</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span><span class=n>minCapacity</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>MAX_ARRAY_SIZE</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>?</span><span class=w> </span><span class=n>Integer</span><span class=p>.</span><span class=na>MAX_VALUE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>:</span><span class=w> </span><span class=n>MAX_ARRAY_SIZE</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Increases the capacity to ensure that it can hold at least the
</span></span></span><span class=line><span class=cl><span class=cm> * number of elements specified by the minimum capacity argument.
</span></span></span><span class=line><span class=cl><span class=cm> * 
</span></span></span><span class=line><span class=cl><span class=cm> * @param minCapacity the desired minimum capacity
</span></span></span><span class=line><span class=cl><span class=cm> * @throws OutOfMemoryError if minCapacity is less than zero
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=nf>grow</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>minCapacity</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>elementData</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Arrays</span><span class=p>.</span><span class=na>copyOf</span><span class=p>(</span><span class=n>elementData</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                       </span><span class=n>newCapacity</span><span class=p>(</span><span class=n>minCapacity</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=nf>grow</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>grow</span><span class=p>(</span><span class=n>size</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h2 id=add>add()</h2><p>add 方法一共有两个公开方法，一个是在尾部添加元素的 add(E e) 和在任意位置插入元素的 add(int index, E element)</p><h3 id=尾部插入-adde-e>尾部插入 add(E e)</h3><p>该公开方法调用了 <code>add(E e, Object[] elementData, int s)</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Appends the specified element to the end of this list.
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @param e element to be appended to this list
</span></span></span><span class=line><span class=cl><span class=cm> * @return {@code true} (as specified by {@link Collection#add})
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>add</span><span class=p>(</span><span class=n>E</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>modCount</span><span class=o>++</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>add</span><span class=p>(</span><span class=n>e</span><span class=p>,</span><span class=w> </span><span class=n>elementData</span><span class=p>,</span><span class=w> </span><span class=n>size</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>如果当前容量已满则进行扩容，否则直接把元素放到 <code>s (= size)</code> 的位置，数组元素长度 <code>size + 1</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * This helper method split out from add(E) to keep method
</span></span></span><span class=line><span class=cl><span class=cm> * bytecode size under 35 (the -XX:MaxInlineSize default value),
</span></span></span><span class=line><span class=cl><span class=cm> * which helps when add(E) is called in a C1-compiled loop.
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>add</span><span class=p>(</span><span class=n>E</span><span class=w> </span><span class=n>e</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=n>elementData</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>s</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>s</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>elementData</span><span class=p>.</span><span class=na>length</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>elementData</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>grow</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>elementData</span><span class=o>[</span><span class=n>s</span><span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>e</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h3 id=任意位置插入-addint-index-e-element>任意位置插入 add(int index, E element)</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Inserts the specified element at the specified position in this
</span></span></span><span class=line><span class=cl><span class=cm> * list. Shifts the element currently at that position (if any) and
</span></span></span><span class=line><span class=cl><span class=cm> * any subsequent elements to the right (adds one to their indices).
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @param index index at which the specified element is to be inserted
</span></span></span><span class=line><span class=cl><span class=cm> * @param element element to be inserted
</span></span></span><span class=line><span class=cl><span class=cm> * @throws IndexOutOfBoundsException {@inheritDoc}
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>add</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>index</span><span class=p>,</span><span class=w> </span><span class=n>E</span><span class=w> </span><span class=n>element</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// 检查要插入的位置是否越界</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// 检查的范围为 [0, size]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>rangeCheckForAdd</span><span class=p>(</span><span class=n>index</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>modCount</span><span class=o>++</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>final</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>s</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=n>elementData</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// 数组已经放满了，需要进行扩容</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>((</span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>size</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=p>(</span><span class=n>elementData</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>elementData</span><span class=p>).</span><span class=na>length</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>elementData</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>grow</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// 把原来元素拷贝一份到新数组</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>System</span><span class=p>.</span><span class=na>arraycopy</span><span class=p>(</span><span class=n>elementData</span><span class=p>,</span><span class=w> </span><span class=n>index</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                     </span><span class=n>elementData</span><span class=p>,</span><span class=w> </span><span class=n>index</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>1</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                     </span><span class=n>s</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>index</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>elementData</span><span class=o>[</span><span class=n>index</span><span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>element</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h2 id=remove>remove()</h2><p><code>public E remove(int index)</code> 和 <code>public boolean remove(Object o)</code> 方法底层都依赖于 <code>fastRemove(Object[] es, int i)</code> 方法，底层原理就是把要删除元素的的索引 <code>i</code> 之后的元素拷贝到 <code>i</code> 开始的位置，直接把要删除的元素直接覆盖掉</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Private remove method that skips bounds checking and does not
</span></span></span><span class=line><span class=cl><span class=cm> * return the value removed.
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>fastRemove</span><span class=p>(</span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=n>es</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>modCount</span><span class=o>++</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>final</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>newSize</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>((</span><span class=n>newSize</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>size</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>1</span><span class=p>)</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>i</span><span class=p>)</span><span class=w> </span><span class=c1>// 更新当前元素个数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=c1>// 从 i + 1 的位置开始拷贝到从 i 开始的位置，覆盖掉 i 处元素</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>arraycopy</span><span class=p>(</span><span class=n>es</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=n>es</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=n>newSize</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>i</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>es</span><span class=o>[</span><span class=n>size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>newSize</span><span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div></div></article></main></div><footer class=footer><span class=footer_item></span>&nbsp;<div class=footer_social-icons><a href=https://github.com/ileonli target=_blank rel="noopener noreferrer me" title=Github><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a><a href=/index.xml target=_blank rel="noopener noreferrer me" title=Rss><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></div><small class=footer_copyright>© 2025 Leon Li.
Powered by <a href=https://github.com/hugo-sid/hugo-blog-awesome target=_blank rel=noopener>Hugo blog awesome</a>.</small></footer><a href=# title=回到顶部 id=totop><svg width="48" height="48" fill="currentcolor" stroke="currentcolor" viewBox="0 96 960 960"><path d="M283 704.739 234.261 656 480 410.261 725.739 656 677 704.739l-197-197-197 197z"/></svg>
</a><script src=https://ileonli.github.io/js/main.min.35f435a5d8eac613c52daa28d8af544a4512337d3e95236e4a4978417b8dcb2f.js integrity="sha256-NfQ1pdjqxhPFLaoo2K9USkUSM30+lSNuSkl4QXuNyy8="></script></body></html>